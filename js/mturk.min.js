$(function(){$("#qualtricsHeaderCode").focus(function(){$(this).select().mouseup(function(d){d.off("mouseup");d.preventDefault()})}).keyup(function(d){9===d.which&&this.select()});$("#reward").change(function(){$(this).val(sprintf("%0.2f",parseFloat($(this).val(),10)))});$("#country").fcbkcomplete({json_url:"iso.json",addontab:!0,height:5,cache:!0,firstselected:!0});$(".controls").find("input, select, textarea").tooltip({placement:"right",trigger:"focus"});$("#mturkQualtricsHelperForm").validate({rules:{AccessKeyId:"required",
AccessKey:"required",Title:"required",ExternalUrl:{required:!0,url:!0},Description:"required",FrameHeight:{required:!0,number:!0},MaxAssignments:{required:!0,number:!0},"Reward.1.Amount":{required:!0,number:!0},"duration[time]":{required:!0,number:!0},"autoApprovalDelay[time]":{required:!0,number:!0},"lifetime[time]":{required:!0,number:!0},confirmation:"required"},messages:{confirmation:{required:"Please check the box above"}},errorPlacement:function(d,e){e.parents(".controls").append(d)},errorElement:"span",
errorClass:"help-inline",highlight:function(d,e,f){$(d).parents(".control-group").addClass("error")},unhighlight:function(d,e,f){$(d).parents(".control-group").removeClass("error")},submitHandler:function(d){var e=new Date,f=[],a={},g,f=[null,60,3600,86400,604800,2592E3];a.Timestamp=sprintf("%4d-%02d-%02dT%02d:%02d:%02d+00:00",e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());a.Signature=CryptoJS.HmacSHA1("AWSMechanicalTurkRequesterCreateHIT"+
a.Timestamp,$("#accessKey").val()).toString(CryptoJS.enc.Base64);$.each($(d).serializeArray(),function(b,c){"Sandbox"===c.name?a.Sandbox=1:"country[]"===c.name?a.country=$("#country").val():a[c.name]=c.value});a.AutoApprovalDelayInSeconds=a["autoApprovalDelay[time]"]*f[a["autoApprovalDelay[units]"]];a.AssignmentDurationInSeconds=a["duration[time]"]*f[a["duration[units]"]];a.LifetimeInSeconds=a["lifetime[time]"]*f[a["lifetime[units]"]];delete a["autoApprovalDelay[time]"];delete a["autoApprovalDelay[units]"];
delete a["duration[time]"];delete a["duration[units]"];delete a["lifetime[time]"];delete a["lifetime[units]"];a.country&&$.each(a.country,function(b,c){a["QualificationRequirement."+ ++b+".QualificationTypeId"]="00000000000000000071";a["QualificationRequirement."+b+".Comparator"]=("exclude"===a.countryStatus?"Not":"")+"EqualTo";a["QualificationRequirement."+b+".LocaleValue.Country"]=c});delete a.country;delete a.countryStatus;a.RequesterAnnotation="uid";a["Reward.1.CurrencyCode"]="USD";a.Sandbox&&
(a.ExternalUrl+="&amp;test=1");a.Question='<ExternalQuestion xmlns="http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2006-07-14/ExternalQuestion.xsd">';a.Question+="<ExternalURL>"+a.ExternalUrl+"</ExternalURL>";a.Question+="<FrameHeight>"+a.FrameHeight+"</FrameHeight>";a.Question+="</ExternalQuestion>";delete a.ExternalUrl;delete a.FrameHeight;g=sprintf("https://mechanicalturk.sandbox.amazonaws.com/?Service=%s&Version=%s&Operation=%s","AWSMechanicalTurkRequester","2012-03-25","CreateHIT");
$.each(a,function(a,c){g+="&"+encodeURIComponent(a)+"="+encodeURIComponent(c)});g=g.replace("ExternalQuestion%20xmlns","ExternalQuestion+xmlns");$.ajax({beforeSend:function(){$(document.body).showLoading()},cache:!1,complete:function(){$(document.body).hideLoading()},data:{awsUrl:g,_render:"json"},dataType:"jsonp",jsonp:"_callback",success:function(b){if(0<b.count)if("True"===b.value.items[0].HIT.Request.IsValid){var c;c=sprintf("https://requester%s.mturk.com/mturk/manageHIT?HITId=%s",a.Sandbox?"sandbox":
"",b.value.items[0].HIT.HITId);b=sprintf("https://%s.mturk.com/mturk/preview?groupId=%s",a.Sandbox?"workersandbox":"www",b.value.items[0].HIT.HITTypeId);c=sprintf('You can <a href="%s" title="Manage HIT (Requester)">manage</a> and <a href="%s" title="Preview HIT as a Worker">preview</a> your HIT on Amazon Mechanical Turk.',c,b);Notifier.success(c,"Success","icon")}else Notifier.error(b.value.items[0].HIT.Request.Errors.Error.Message,b.value.items[0].HIT.Request.Errors.Error.Code,"icon");else Notifier.error("An unknown error occurred. Please try again.",
"Unknown Error","icon")},url:"http://pipes.yahoo.com/pipes/pipe.run?_id=2837ae31359fe70fd20497bd54e4dd10"});return!1}})});
