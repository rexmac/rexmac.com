(function(e,t,r,n){"use strict";function a(e,t,r,n){this.x=e,this.y=t,this.width=r,this.height=n}a.prototype.style=function(){return{top:this.y,left:this.x,width:this.width,height:this.height}};var s,i={init:function(t){return s=e.extend({},e.fn.treemap.defaults,t),this.each(function(){var t,r,i,l,o,d,u,g,b,p,f,c=e(this),m=c.data("treemap");if(!m&&(s.data===n&&c.is("ul")&&(s.data=[],c.children().each(function(){var t=e(this);s.data.push({label:t.html(),value:parseInt(t.attr("value"),10)})})),n!==s.data)){for(t=e("<div/>").addClass("treemap").css("position","relative"),t.css({width:s.width,height:s.height}),r=new a(0,0,t.width(),t.height()),i=JSON.parse(JSON.stringify(s.data)),i.sort(function(e,t){return t.value-e.value}),h.tessellate(i,r),p=[h.hex2hsb(s.colors[0]),h.hex2hsb(s.colors[1])],l=0,o=i.length,g=i[o-1].value,b=i[0].value;o>l;++l)d=i[l],u=e("<div/>").addClass("treemap-node"),d.id&&u.attr("id",d.id),d["class"]&&u.addClass(d["class"]),u.html(d.label),u.data("value",d.value),u.css(e.extend(d.bounds.style(),{position:"absolute",backgroundColor:"#"+h.rgb2hex(h.hsb2rgb(h.lerpHsb(d.value,b,p[0],p[1])))})),u.appendTo(t);c.is("ul")?c.after(t).hide():t.appendTo(c),s.legend&&(f=e("<div/>").addClass("treemap-legend"),f.append(e("<span/>").addClass("treemap-legend-begin").text(s.legendLabels[0])),f.append(e("<span/>").addClass("treemap-legend-end").text(s.legendLabels[1])),"top"===s.legendPosition?f.insertBefore(t):f.insertAfter(t)),c.data("treemap",{treemap:t,legend:f})}})},destroy:function(){return this.each(function(){var t=e(this),r=t.data("treemap");r&&(r.legend&&r.legend.remove(),r.treemap.remove(),t.removeData("treemap"),t.is("ul")&&t.show())})}},h={tessellate:function(e,t){if(0!==e.length){if(1===e.length)return e[0].bounds=t,n;var r=h.splitNodes(e),s=h.sumNodeValues(r.left),i=h.sumNodeValues(r.right),l=s+i,o=0,d=!1;l>0&&(t.width>t.height?o=Math.round(s*t.width/l):(d=!0,o=Math.round(s*t.height/l))),d===!1?(h.tessellate(r.left,new a(t.x,t.y,o,t.height)),h.tessellate(r.right,new a(t.x+o,t.y,t.width-o,t.height))):(h.tessellate(r.left,new a(t.x,t.y,t.width,o)),h.tessellate(r.right,new a(t.x,t.y+o,t.width,t.height-o)))}},lerpHsb:function(e,t,r,n){return{h:r.h+(n.h-r.h)*e/t,s:r.s+(n.s-r.s)*e/t,b:r.b+(n.b-r.b)*e/t}},expandHex:function(e){return(e=e.replace(/[^A-F0-9]/gi,""))?(3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6===e.length?e:null):null},hex2hsb:function(e){var t=h.rgb2hsb(h.hex2rgb(h.expandHex(e)));return 0===t.s&&(t.h=360),t},hex2rgb:function(e){return e=parseInt(h.expandHex(e),16),{r:e>>16,g:(65280&e)>>8,b:255&e}},hsb2rgb:function(e){var t,r,n,a={r:0,g:0,b:0},s=Math.round(e.h),i=Math.round(255*e.s/100),h=Math.round(255*e.b/100);return 0===i?a.r=a.g=a.b=h:(t=h,r=(255-i)*h/255,n=(t-r)*(s%60)/60,360===s&&(s=0),60>s?(a.r=t,a.g=r+n,a.b=r):120>s?(a.r=t-n,a.g=t,a.b=r):180>s?(a.r=r,a.g=t,a.b=r+n):240>s?(a.r=r,a.g=t-n,a.b=t):300>s?(a.r=r+n,a.g=r,a.b=t):360>s&&(a.r=t,a.g=r,a.b=t-n)),{r:Math.round(a.r),g:Math.round(a.g),b:Math.round(a.b)}},rgb2hex:function(t){var r=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(r,function(e,t){1===t.length&&(r[e]="0"+t)}),r.join("")},rgb2hsb:function(e){var t={h:0,s:0,b:0},r=Math.min(e.r,e.g,e.b),n=Math.max(e.r,e.g,e.b),a=n-r;return t.b=n,t.s=0!==n?255*a/n:0,t.h=0!==t.s?e.r===n?(e.g-e.b)/a:e.g===n?2+(e.b-e.r)/a:4+(e.r-e.g)/a:-1,t.h*=60,0>t.h&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},splitNodes:function(e){for(var t=h.sumNodeValues(e)/2,r=0,n=0,a=e.length;a>n&&!(n>0&&r+e[n].value>t);++n)r+=e[n].value;return{left:e.slice(0,n),right:e.slice(n)}},sumNodeValues:function(e){for(var t=0,r=0,n=e.length;n>r;++r)t+=e[r].value;return t}};e.fn.treemap=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method '"+t+"' does not exist on jquery.treemap"),n):i.init.apply(this,arguments)},e.fn.treemap.defaults={colors:["#f00","#0f0"],legend:!1,legendLabels:["Low","High"],legendPosition:"bottom",width:500,height:300}})(jQuery,window,document);